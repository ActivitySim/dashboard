<template lang="pug">
.time-slider-main-content
  vue-slider.time-slider(v-bind="timeSlider" v-model="sliderValue")
</template>

<script lang="ts">
import * as timeConvert from 'convert-seconds'
import vueSlider from 'vue-slider-component'
import { Vue, Component, Prop, Watch } from 'vue-property-decorator'

@Component({ components: { 'vue-slider': vueSlider } })
export default class TimeSlider extends Vue {
  @Prop() private useRange!: false
  @Prop({ required: true }) private stops!: any[]
  @Prop({ required: false }) private dropdownValue!: string

  private sliderValue: any = ''

  @Watch('dropdownValue') dropdownChanged(value: string) {
    this.sliderValue = value
  }

  private timeSlider = {
    adsorb: true,
    contained: true,
    data: [] as any[],
    'enable-cross': false,
    height: 8,
    piecewise: true,
    show: false,
    marks: [] as any[],
    minRange: 1,
    processStyle: { backgroundColor: '#00bb5588', borderColor: '#f05b72' },
    sliderStyle: [{ backgroundColor: '#f05b72' }, { backgroundColor: '#3498db' }],
    'tooltip-placement': 'top',
  }

  private mounted() {
    this.sliderValue = this.stops[0] || '...'
    this.timeSlider.data = this.stops
    this.timeSlider.marks = [
      this.stops[0],
      this.stops[Math.floor(this.stops.length / 2)],
      this.stops[this.stops.length - 1],
    ] // this.stops.filter((stop, i) => i % 3 === 0)
  }

  @Watch('useRange')
  private changeUseRange(useIt: boolean) {
    if (useIt) {
      this.sliderValue = [this.stops[0], this.stops[this.stops.length - 1]]
    } else {
      this.sliderValue = [this.stops[0]]
    }
    console.log('changed to: ' + this.sliderValue)
  }

  // @Watch('stops')
  // private setStops(newStops: any) {
  //   console.log({ newStops })
  //   this.timeSlider.data = newStops
  // }

  @Watch('sliderValue')
  private sliderChangedEvent(result: any) {
    this.$emit('change', result)
  }
}
</script>

<style scoped>
@import '../../../node_modules/vue-slider-component/theme/default.css';

.time-slider-main-content {
  padding: 0.5rem 0.25rem 2rem 0.25rem;
  margin: 0 0.2rem;
}
</style>
